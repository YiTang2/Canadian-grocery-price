---
title: "Canadian grocery analysis"
author: 
  - Jin Zhang
  - Yitang
  - Siyuan Lu
thanks: "Code and data are available at: https://github.com/YiTang2/Canadian-grocery-price.git"
date: 14 November 2024
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(scales)
library(tidyverse)
library(ggplot2)
library(here)

```


# Introduction
This paper aims to drive more competition and reduce collusion in the Canadian grocery sector. The same research can be done to other sectors to achieve similar goals like increasing competition and decreasing collusion in the sector. We use SQL @SQL to clean the raw data and R @citeR to analyze and visualize cleaned data. We create three figures @ggplot to show the distribution and relation between current price and old price of products from different grocery vendors. We found that the grocery vendors tend to use competitive pricing tactics or responses to market demand dynamics due to many items have remained the same price or become cheaper.revealing how different vendors position themselves in the market and how prices evolve over time.

# Data {#sec-data}

## Overview

All datas aim to foster competition and reduce market collusion in the Canadian grocery sector by assembling a database of historical grocery prices from prominent vendors. This dataset serves academic and legal purposes, enhancing transparency in grocery pricing strategies.The data encompasses prices from eight major grocery vendors in Canada, including Voila, TandT, Loblaws, and others. Prices are specifically for "in-store pickup" in Toronto, collected via screen-scraping of vendor websites. This method captures customer-facing prices but may miss details available in internal APIs. Below is the description for the variable we are taking to research:

- vendor: One of the 7 grocery vendors.
- current_price: Price at time of extract.
- old_price: An "old" struck-out price. This indicates that there was a Sale on. This is how you can differentiate a price-drop advertised as a Sale vs. a "quiet" decrease without a Sale.
- units: Units (grams, kg, number of items in package). May be blank for some vendors/products.

The dataset facilitates analysis through visualizations like price trends over time for products such as Becel Margarine and Sourdough Bread. Each visualization aids in comparing pricing strategies across different vendors and times. Exploratory data analysis provides insights into pricing patterns, with summary statistics highlighting average prices, standard deviations, and price ranges. Comparative analysis across vendors or periods can spotlight trends or anomalies in pricing behaviors.

## Measurement
	
The measurement process involves converting observed grocery pricing phenomena into a structured dataset. This transformation starts with the collection of price data from various Canadian grocery vendors' websites through screen-scraping techniques. Each price observation captures the 'current price' at the time of data collection and the 'old price', which indicates the previous price point before any discounts or changes. This approach allows us to trace price fluctuations over time and analyze market behaviors.

To ensure accuracy and relevance, the data is collected for items available for in-store pickup in a specific Toronto neighborhood, providing a consistent geographical context. The 'units' associated with each product, such as grams or kilograms, are noted to standardize price comparisons. This meticulous approach to data measurement facilitates a comprehensive analysis of pricing strategies across different vendors, revealing trends and potential collusive behaviors within the market.

## Outcome variables
Some of our data is of current price (@fig-current-price), from @JacobFilipp
```{r}
#| label: fig-current-price
#| fig-cap: Distribution of Current Prices in Canadian Grocery Sector
#| echo: false
#| warning: false
#| message: false

data <- read_csv(here::here("data","02-analysis_data","analysis_data.csv"))

# Applying a smaller bin width to better capture the distribution
ggplot(data, aes(x=current_price)) +
  geom_histogram(binwidth=1, fill="blue", color="black") +  # Set binwidth to 1 for finer granularity
  labs(title="Distribution of Current Prices in Canadian Grocery Sector", x="Current Price ($)", y="Frequency") +
  xlim(0, 50)+  # Limiting x-axis to focus on the common price range
  scale_y_continuous(labels = comma)

```
@fig-current-price shows the distribution of current prices in the Canadian grocery sector. The x-axis of this histogram represents the range of current prices in Canadian dollars, while the y-axis indicates the frequency of each price point. This visualization allows us to see that most grocery items are priced under $10, showcasing a significant decline in frequency as prices increase. This distribution shows a concentration of more affordable items, with fewer high-priced items, indicating a price-sensitive market where cheaper products dominate the sales volume.


Some of our data is of price (@fig-current-price), from @JacobFilipp
```{r}
#| label: fig-vendor-price-distribution
#| fig-cap: Distribution of Prices by Vendor in Canadian Grocery Sector
#| echo: false
#| warning: false
#| message: false

ggplot(data, aes(x=vendor, y=log(current_price))) +
  geom_boxplot(fill="blue", color="black") +
  labs(title="Logarithmic Distribution of Prices by Vendor in Canadian Grocery Sector", x="Vendor", y="Log of Current Price ($)") +
  theme_minimal()  # Applying a minimalistic theme
```
@fig-vendor-price-distribution shows the logarithmic distribution of prices by different vendors in the Canadian grocery sector, using a box plot for each vendor. The x-axis categorizes the vendors, and the y-axis shows the logarithm of current prices, which shows the wide range of prices and highlighting the differences in price distributions across vendors. Each box plot provides the median, interquartile range (IQR), and potential outliers, revealing variability in pricing strategies among vendors. For instance, some vendors show a wider range of prices, indicating a diverse product mix, while others have more compact distributions, suggesting more consistent pricing across their products.


Some of our data is of comparison of price (@fig-price-comparison), from @JacobFilipp
```{r}
#| label: fig-price-comparison
#| fig-cap: Comparison of Old and Current Prices in Canadian Grocery Sector
#| echo: false
#| warning: false
#| message: false


ggplot(data, aes(x=old_price, y=current_price)) +
  geom_point(color="blue",alpha=0.1) +
  labs(title="Comparison of Old and Current Prices in Canadian Grocery Sector", x="Old Price ($)", y="Current Price ($)") +
  xlim(0, 100) + ylim(0, 100) +
  geom_abline(intercept=0, slope=1, linetype="dashed", color="red")  # Reference line for equal prices

```
@fig-price-comparison visualizes the relationship between old and current prices of grocery items in a scatter plot. The x-axis represents the old prices, and the y-axis the current prices, both in Canadian dollars. The diagonal red dashed line indicates where the old and current prices are equal. Points below this line represent price drops, while points above indicate price increases. This graph reveals a significant cluster of points along and below the line, suggesting that many items have remained the same price or become cheaper. This could indicate competitive pricing tactics or responses to market demand dynamics.

## Predictor variables

Add graphs, tables and text.

Use sub-sub-headings for each outcome variable and feel free to combine a few into one if they go together naturally.








# Model

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.  

\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

first_model <-
  readRDS(file = here::here("models/first_model.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false

modelsummary::modelsummary(
  list(
    "First model" = first_model
  ),
  statistic = "mad",
  fmt = 2
)
```




# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

Please don't use these as sub-heading labels - change them to be what your point actually is.

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

pp_check(first_model) +
  theme_classic() +
  theme(legend.position = "bottom")

posterior_vs_prior(first_model) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  coord_flip()
```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

plot(first_model, "trace")

plot(first_model, "rhat")
```



\newpage


# References


